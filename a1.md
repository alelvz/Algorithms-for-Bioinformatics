
---

# CS249 Assignment Report

## Task 1: Metagenome Classification by String Matching

In this task, reference genomes act as the **text** and sequencing reads are the **patterns** being searched for. Using string matching, we classify reads by comparing them against the known reference sequences.

### Reference and Read Sizes

| Species                    | Genome Size (bp) |
|---------------------------|------------------|
| *E. coli* K-12 MG1655     | 4,641,652        |
| *B. subtilis* 168         | 4,215,606        |
| *P. aeruginosa* PAO1      | 6,264,404        |
| *S. aureus* NCTC 8325     | 2,821,361        |
| *M. tuberculosis* H37Rv   | 4,411,532        |

| Read File                             | Total bp   |
|--------------------------------------|------------|
| simulated_reads_miseq_10k_R1.fastq.gz  | 3,114,900  |
| simulated_reads_miseq_10k_R2.fastq.gz  | 3,114,900  |
| simulated_reads_no_errors_10k_R1.fastq.gz | 1,354,900  |
| simulated_reads_no_errors_10k_R2.fastq.gz | 1,354,900  |

---

### Task 1.1: Multiple Matches

We implemented the **Aho-Corasick** algorithm to efficiently identify all reads that match multiple organisms. Each reference genome was broken into overlapping k-mers and inserted into a trie. The classification step recorded every genome that matched each read, which reflects the biological complexity of metagenomic samples.

---

### Task 1.2: Exact Matching (k=31)

#### Classification Results

| Reads        | E. coli | S. aureus | B. subtilis | M. tuberculosis | P. aeruginosa |
|--------------|---------|-----------|-------------|------------------|----------------|
| no_errors_R1 | 3002    | 509       | 507         | 504              | 518            |
| no_errors_R2 | 106     | 31        | 29          | 21               | 50             |
| miseq_R1     | 3004    | 515       | 512         | 512              | 524            |
| miseq_R2     | 91      | 29        | 18          | 12               | 28             |

#### Runtime and Memory Usage

| Reads        | Time (s) | Memory (MB) |
|--------------|----------|-------------|
| no_errors_R1 | 275.94   | 27525.48    |
| no_errors_R2 | 367.82   | 27502.35    |
| miseq_R1     | 332.97   | 27524.41    |
| miseq_R2     | 269.05   | 27525.90    |

---

### Task 1.3: Approximate Matching (1 mismatch allowed)

| Reads        | E. coli | S. aureus | B. subtilis | M. tuberculosis | P. aeruginosa |
|--------------|---------|-----------|-------------|------------------|----------------|
| no_errors_R1 | 3009    | 518       | 511         | 509              | 537            |
| no_errors_R2 | 106     | 31        | 29          | 21               | 50             |
| miseq_R1     | 3005    | 524       | 523         | 518              | 545            |
| miseq_R2     | 137     | 52        | 35          | 25               | 68             |

| Reads        | Time (s) | Memory (MB) |
|--------------|----------|-------------|
| no_errors_R1 | 370.80   | 27475.06    |
| no_errors_R2 | 285.64   | 27475.17    |
| miseq_R1     | 388.72   | 27475.04    |
| miseq_R2     | 339.49   | 27491.49    |

---

### Task 1.4: Comparison with BLASTN

| Reads        | E. coli | S. aureus | B. subtilis | M. tuberculosis | P. aeruginosa |
|--------------|---------|-----------|-------------|------------------|----------------|
| no_errors_R1 | 3547    | 541       | 555         | 650              | 526            |
| no_errors_R2 | 3508    | 550       | 563         | 587              | 522            |
| miseq_R1     | 1680    | 208       | 177         | 185              | 172            |
| miseq_R2     | 610     | 60        | 84          | 42               | 52             |

> **Performance:** BLAST took 43 seconds and 224.79 MB, showing its heuristic nature compared to Aho-Corasick’s exhaustive matching.

---

## Task 2: k-mer Indexing for Classification

### Task 2.1: Build the k-mer Index

- **Data structure:** A `defaultdict(list)` was used to map each 31-mer to its source genomes.
- **Unique 31-mers Indexed:** 22,104,695
- **Theoretical 31-mers:** 4,611,686,018,427,387,904 (4⁻³¹)

> **Discrepancy Explanation:** Real genomes are limited in size, contain repetitive regions, and are shaped by biological constraints—hence the actual count is far lower.

---

### Task 2.2: Classify with Full k-mer Index

- Reads were classified by searching for exact matches of k-mers in the index.
- We counted both the number of matching reads and total number of matched k-mers.

> **Observation:** String matching finds slightly more reads due to tolerance for mismatches or variations, while k-mer matching requires perfect identity.

> **Multiple Matches Handling:** All occurrences were counted to reflect repetitive and conserved genomic regions.

---

### Task 2.3: Classification with Minimizers

To improve memory efficiency, we implemented a minimizer-based indexing scheme (using w=10) and compared its performance.

| Method             | Memory Usage (MB) |
|--------------------|-------------------|
| Full k-mer Index   | 4448.64           |
| Minimizer Index    | 975.05            |

> **Memory Reduced by ~78%**  
> Minimizer indexing achieves similar classification results while dramatically lowering memory usage.

#### 📊 Plots: Number of Matching Reads per Species

*(Insert bar plot here if uploading to a repo with images)*

---

## Summary

This assignment explored and compared multiple methods for metagenome classification, including:
- Trie-based exact and approximate matching (Aho-Corasick)
- Heuristic alignment (BLAST)
- Full k-mer indexing and minimizer-based indexing

The analysis revealed trade-offs between sensitivity, runtime, and memory consumption across methods, highlighting how data structures and sketching techniques play critical roles in scalable bioinformatics.

---
